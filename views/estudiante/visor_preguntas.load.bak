<article>
{{if pregunta:}}
    <!--Card-->
    <div class="card wow fadeInRightBig" data-wow-delay="0.2s" style="padding: 10px;">
        <!--Card title-->
        <div class="overlay hm-white-slight">
                {{=H5(CAT(int(pregunta.tipo)+1, '.)', ' ',tipo_pregunta[pregunta.tipo]))}}
                <!--Text-->
                <hr/>
            </div>
        <div class="overlay hm-white-slight">
            <!--Text-->
            <div class="col-md-12">
                <p class="card-text">{{=P(pregunta.descripcion)}}</p>
            </div>
        </div>
        <!--/.Card title-->

        <!--Card content-->
        <div class="card-block text-xs-center">
            <div class="row">
                <div class="col-md-12">
                    <div class="alert alert-success alert-dismissible message" role="alert">{{=T('Responda la respuesta')}}</div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6 col-md-offset-1">
                    <form id="pregunta-form" enctype="multipart/form-data">
                        <input type="hidden" name="id" value="{{=respuesta_id}}">
                        <input type="hidden" name="intrusiones" value="0">
                        <input type="hidden" name="aciertos" value="0">

                        {{if pregunta.tipo == '0':}}
                            {{=UL(LI(CAT(H3(pregunta.texto), INPUT(_type="hidden", _name="pregunta", _value=pregunta.id), INPUT(_type="text", _name="texto"))), _class="nav")}}
                        {{elif pregunta.tipo == '1':}}
                            <ul class="nav">
                                <li><h3 class="wow fadeOut desaparecer" data-wow-delay="{{=pregunta.tiempo}}s">{{=pregunta.texto}}</h3> {{=CAT(INPUT(_type="hidden", _name="pregunta", _value=pregunta.id), INPUT(_type="text", _name="texto", _placeholder=T("Responde aquí")))}}</li>
                            </ul>

                        {{elif pregunta.tipo == '2':}}
                            <ul class="nav">
                                <li><h3 class="wow fadeOut desaparecer" data-wow-delay="{{=pregunta.tiempo}}s">{{=pregunta.texto}}</h3> {{=CAT(INPUT(_type="hidden", _name="pregunta", _value=pregunta.id), INPUT(_type="text", _name="texto", _placeholder=T("Responde aquí")))}}</li>
                            </ul>
                        {{elif pregunta.tipo == '3':}}
                            <ul class="nav">
                                <li>
                                    {{for i in pregunta.texto.split('-'):}}
                                        {{if str(i) in pregunta.respuesta.split('-'):}}
                                            <div class="wow fadeOut aparecer" data-wow-delay="{{=pregunta.respuesta.split('-').index(str(i))*pregunta.tiempo}}s" style="background-color: rgba(227, 8, 19, 0.9); width: 50px; height: 50px; margin: 5px; padding: 5px; position: relative; float: left; text-align: center;">
                                                <p style="color: white">{{=i}}</p>
                                            </div>
                                        {{else:}}
                                            {{=DIV(P(i, _style="color: white"), _style="background-color: rgba(227, 8, 19, 0.9); width: 50px; height: 50px; margin: 5px; padding: 5px; position: relative; float: left; text-align: center;")}}
                                        {{pass}}
                                    {{pass}}
                                </li>
                                <li>{{=CAT(INPUT(_type="hidden", _name="pregunta", _value=pregunta.id), INPUT(_type="text", _name="texto", _placeholder=T("Ejemplo: 2-3-4")))}}</li>
                            </ul>
                        {{elif pregunta.tipo == '4':}}
                            <div class="wow fadeOut" data-wow-delay="{{=pregunta.tiempo}}s" style="opacity: 0; background-color: #{{=pregunta.respuesta}}; width: 50px; height: 50px; border-radius: 25px;">
                            </div>
                            {{=INPUT(_type="hidden", _name="pregunta", _value=pregunta.id)}}
                            <ul class="nav pagination">
                                {{for i in pregunta.texto.split('-'):}}
                                    <label><li class="wow fadeIn" data-wow-delay="{{=pregunta.tiempo+1}}s" style="margin: 3px; opacity: 1; background-color: #{{=i}}; width: 50px; height: 50px; border-radius: 25px;">
                                         <input type="radio" style=" margin-left: 4px; margin-top: 20px;" name="text" value="{{=i}}">
                                        </li></label>
                                {{pass}}
                            </ul>

                        {{elif pregunta.tipo == '5':}}
                            <ul class="nav">
                                <li>
                                    {{k=1}}
                                    {{for i in pregunta.texto.split('-'):}}
                                        <div class="wow hinge" data-wow-delay="{{=k}}s" style="opacity: 0; background-color: #e21410; width: 50px; height: 50px; margin: 5px; padding: 5px; position: relative; float: left; text-align: center;">
                                            <p style="color: white">{{=i}}</p>
                                        </div>
                                    {{k=k+pregunta.tiempo}}
                                    {{pass}}
                                </li>
                                <li>{{=CAT(INPUT(_type="hidden", _name="pregunta", _value=pregunta.id), INPUT(_type="text", _name="texto", _placeholder=T("Cantidad de ocurrencias ejemplo: 3")))}}</li>
                            </ul>
                        {{elif pregunta.tipo == '6':}}

                            {{=UL(LI(CAT(pregunta.texto, INPUT(_type="hidden", _name="pregunta", _value=pregunta.id), INPUT(_type="text", _id="tipo_6", _name="texto"))), _class="nav")}}
                            <script>
                                $(function(){
                                    var timer = $.timer({{=pregunta.tiempo}}*1000, function() {
                                        $('#tipo_6').attr('disabled', 'disables');
                                        $('.message').text("{{=T('Se agotó el tiempo')}}");
                                    });
                                });
                            </script>
                        {{else:}}
                            <h1>Error </h1>
                        {{pass}}
                    </form>
                </div>
                <div class="col-md-2 col-md-offset-2">
                    {{=A(T("Guardar"), _id="guardar", _class="btn btn-default btn-lg")}}
                </div>
            </div>

            <div class="row">
                <div class="col-md-12">
                    <hr />
                </div>
                <div class="col-md-6 col-md-offset-1">
                    <nav>
                      <ul class="pagination pagination-lg">
                          <li class="{{if pregunta.tipo == '0':}}active{{pass}}"><span>1 <span class="sr-only"></span></span></li>
                          <li class="{{if pregunta.tipo == '1':}}active{{pass}}"><span>2 <span class="sr-only"></span></span></li>
                          <li class="{{if pregunta.tipo == '2':}}active{{pass}}"><span>3 <span class="sr-only"></span></span></li>
                          <li class="{{if pregunta.tipo == '3':}}active{{pass}}"><span>4 <span class="sr-only"></span></span></li>
                          <li class="{{if pregunta.tipo == '4':}}active{{pass}}"><span>5 <span class="sr-only"></span></span></li>
                          <li class="{{if pregunta.tipo == '5':}}active{{pass}}"><span>6 <span class="sr-only"></span></span></li>
                          <li class="{{if pregunta.tipo == '6':}}active{{pass}}"><span>7 <span class="sr-only"></span></span></li>
                      </ul>
                    </nav>
                </div>

                <div class="col-md-2 col-md-offset-2">
                    {{=A("Siguiente", _id="siguiente", _class="btn btn-default btn-lg disabled", _href=URL(args=[pregunta.diagnostico]), cid=request.cid)}}
                </div>
            </div>

        </div>
    </div>
    <!--/.Card content-->

    <script text="javascript">
        $(function () {
            /*Función ajax para guardar la pregunta*/
            $('#guardar').click(function(event){

                var formData = $('#pregunta-form').serializeArray();

                $.ajax({
                    // la URL para la petición
                    url : 'guardar_respuesta',
                    // la información a enviar
                    // (también es posible utilizar una cadena de datos)
                    data : formData,
                    // especifica si será una petición POST o GET
                    type : 'POST',
                    // el tipo de información que se espera de respuesta
                    dataType : 'json',
                    // código a ejecutar si la petición es satisfactoria;
                    // la respuesta es pasada como argumento a la función
                    success : function(json) {
                        $('.message').text("{{=T('Guardada correctamente')}}");
                        $('#siguiente').removeClass('disabled');
                    },
                    // código a ejecutar si la petición falla;
                    // son pasados como argumentos a la función
                    // el objeto de la petición en crudo y código de estatus de la petición
                    error : function(xhr, status) {
                        $('.alert').text("{{=T('Disculpe, existió un problema')}}");
                    },
                    // código a ejecutar sin importar si la petición falló o no
                    complete : function(xhr, status) {
                        console.log('Petición realizada');
                    }
                });
                event.defaultPrevented;
            });
        });
    </script>
{{else:}}
    <script text="javascript">
        $(function () {
            $('#diagnostico-time').val('false');
        });
    </script>
    {{=H1(T("Se acabaron las preguntas de este cuestionario"))}}
{{pass}}
</article>

<style>
    .desaparecer {
        opacity: 0;
    }

    .aparecer {
        opacity: 1;
    }

</style>
